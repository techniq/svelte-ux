import { defineConfig } from 'vitest/config';
import { sveltekit } from '@sveltejs/kit/vite';
import tailwindcss from '@tailwindcss/vite';
import Icons from 'unplugin-icons/vite';
import { sveld } from './src/lib/plugins/vite.js';

export default defineConfig({
  plugins: [
    tailwindcss(),
    sveltekit(),
    Icons({
      compiler: 'svelte',
      customCollections: {
        'custom-brands': {
          bluesky: `<svg xmlns="http://www.w3.org/2000/svg" width="1.3em" height="1.3em" viewBox="0 0 24 24"><!-- Icon from Huge Icons by Hugeicons - undefined --><path fill="currentColor" d="M15.492 22.082c-1.58 0-2.78-1.8-3.5-3.28c-.72 1.47-1.92 3.28-3.5 3.28c-2.43 0-5.25-2.87-5.25-4.75c0-1.2.66-2.02 1.48-2.59c-1.55-.6-2.57-1.87-2.96-3.76c-.44-2.22-1-6.17.26-7.7c.38-.46.89-.7 1.48-.7c3.45 0 6.97 5.18 8.5 7.74c1.53-2.55 5.05-7.74 8.5-7.74c.59 0 1.1.24 1.48.7c1.26 1.53.7 5.48.26 7.7c-.39 1.89-1.41 3.16-2.96 3.76c.82.56 1.48 1.39 1.48 2.59c0 1.88-2.82 4.75-5.25 4.75zm-3.5-6c.32 0 .61.21.71.51c.54 1.61 1.8 3.98 2.79 3.98c1.65 0 3.75-2.2 3.75-3.25c0-1.78-3.31-2.25-3.34-2.26a.744.744 0 0 1-.65-.83c.05-.41.41-.7.83-.66c2.68.3 4.21-.65 4.68-2.91c.62-3.13.65-5.72.05-6.45a.37.37 0 0 0-.32-.15c-2.71 0-6.2 5.08-7.83 8.08c-.13.24-.39.4-.66.4s-.53-.14-.66-.38l-.01-.02c-1.63-3-5.12-8.08-7.83-8.08c-.14 0-.23.04-.32.15c-.59.73-.57 3.32.05 6.45c.47 2.25 2 3.2 4.68 2.9c.42-.04.78.25.83.66s-.24.78-.65.83c-.03 0-3.34.48-3.34 2.26c0 1.05 2.1 3.25 3.75 3.25c.99 0 2.25-2.38 2.79-3.98c.1-.31.39-.51.71-.51z" color="currentColor"/></svg>`,
          discord: `<svg xmlns="http://www.w3.org/2000/svg" width="1.3em" height="1.3em" viewBox="0 0 24 24"><path d="M 9 4 C 9 4 8.5733125 4.0039062 8.3203125 4.0039062 L 8.3183594 4.0039062 C 7.4503594 4.0039062 6.1811406 4.3226094 5.2441406 4.5996094 C 4.3761406 4.8556094 3.6552344 5.4479531 3.2402344 6.2519531 C 2.4062344 7.8649531 1.166625 11.064 1.015625 16 C 0.995625 16.67 0.9921875 17.261719 0.9921875 17.261719 C 3.7341875 19.674719 8.2167969 20 8.2167969 20 L 9 18.65625 C 9 18.65625 10.653 19.019531 12 19.019531 L 12.013672 19.019531 C 13.360672 19.019531 15.013672 18.65625 15.013672 18.65625 L 16 20 C 16 20 21.251672 18.929531 23.013672 17.019531 C 23.016672 11.507531 21.664391 7.9808125 20.775391 6.2578125 C 20.360391 5.4538125 19.637531 4.8556094 18.769531 4.5996094 C 17.832531 4.3226094 16.564313 4.0039062 15.695312 4.0039062 C 15.442312 4.0039062 15 4 15 4 L 14.001953 5.1425781 C 14.001953 5.1425781 12.686625 4.9882812 12.015625 4.9882812 L 12 4.9882812 C 11.329 4.9882812 10.013672 5.1425781 10.013672 5.1425781 L 9 4 z M 8.3203125 5.5039062 L 8.328125 5.5039062 L 8.890625 6.1386719 L 9.4101562 6.7246094 L 10.189453 6.6328125 C 10.664453 6.5768125 11.576625 6.4882812 12.015625 6.4882812 C 12.492625 6.4882812 13.484172 6.5928125 13.826172 6.6328125 L 14.611328 6.7265625 L 15.132812 6.1308594 L 15.677734 5.5039062 L 15.695312 5.5039062 C 16.229312 5.5039062 17.195703 5.6990625 18.345703 6.0390625 C 18.824703 6.1810625 19.214359 6.5023125 19.443359 6.9453125 C 20.185359 8.3823125 21.407813 11.473422 21.507812 16.357422 C 20.405812 17.174422 18.266953 17.901359 16.626953 18.318359 L 16.414062 18.027344 C 17.536899 17.564441 18.267578 17.107422 18.267578 17.107422 L 17.482422 15.830078 C 17.482422 15.830078 14.704667 17.490234 12 17.490234 C 9.2953333 17.490234 6.5175781 15.830078 6.5175781 15.830078 L 5.7324219 17.107422 C 5.7324219 17.107422 6.4729164 17.575843 7.6210938 18.044922 L 7.4199219 18.388672 C 6.1029219 18.168672 4.0319531 17.630922 2.5019531 16.544922 C 2.5049531 16.390922 2.5086719 16.219922 2.5136719 16.044922 C 2.6576719 11.309922 3.8652656 8.3084531 4.5722656 6.9394531 C 4.8002656 6.5004531 5.1899219 6.1791094 5.6699219 6.0371094 C 6.8189219 5.6971094 7.7843125 5.5039063 8.3203125 5.5039062 z M 8.5 10 A 1.5 2 0 0 0 8.5 14 A 1.5 2 0 0 0 8.5 10 z M 15.5 10 A 1.5 2 0 0 0 15.5 14 A 1.5 2 0 0 0 15.5 10 z" fill="currentColor"></path></svg>`,
        },
      },
    }) /*, sveld()*/,
  ],
  resolve: {
    noExternal: true, // https://github.com/AdrianGonz97/refined-cf-pages-action/issues/26#issuecomment-2878397440
  },
  test: {
    include: ['src/**/*.{test,spec}.{js,ts}'],
    deps: {
      optimizer: {
        ssr: {
          exclude: ['sveld'],
        },
      },
    },
    coverage: {
      reporter: ['html'],
    },
  },
});
